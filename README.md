# 基于知识图谱的糖尿病智能健康处方系统  

在现代医学中，对于多数疾病的干预过程中，运动处方都是关键的一环，运动干预已经被广泛引用于许多慢性疾病的治疗。针对不同种类不同程度的疾病用处方的 形式制订对患者适合的运动内容、运动强度、运动时间及频率，并指出运动中的注意事项，以达到科学地、有计划地进行康复治疗。在慢性疾病中，糖尿病患者对运动处方的需求尤为突出。得益于互联网和信息技术的发展，智能诊疗系统的应用变得逐渐广泛，患者可以通过这些智能系统进行简单的医疗咨询，在就医之前对自身状况进行初步评估。目前已经有研究人员提出过基于知识图谱的医学问答系统，其中也包含针对糖尿病的问答系统。然而，目前针对糖尿病的智能诊疗系统较少，且均没有结合运动处方。  
本课题计划设计一个基于知识图谱的糖尿病智能健康处方系统，为用户提供简单的诊断、医学治疗方案的推荐以及运动项目的推荐，在用户进行医疗咨询时为其推荐运动干预方式，填补智能诊疗系统没有结合运动处方的空白。

<!-- ## 工作进度表  

系统开发完毕并且已经完成测试。  

系统具备以下功能：  
**1.** 糖尿病对话问答；  
**2.** 查看知识图谱；  
**3.** 查看历史记录；  
**4.** 用户管理相关。  

| 日期阶段 | 工作内容 |
| :------- | :------- |
| 2024年3月5日-2024年3月11日 | 对系统开展性能测试，测试登录、医疗对话、知识图谱展示、知识图谱展示（搜索结点）、历史记录功能。 |
| 2024年2月26日-2024年3月4日 | 对系统开展功能测试，测试医疗对话、知识图谱展示、知识图谱展示（搜索结点）功能。 |
| 2024年1月1日-2024年2月5日 | 系统集成开发。 |
| 2023年12月18日-2023年12月31日 | 学习Web应用程序设计以及前端设计。 |
| 2023年12月11日-2023年12月17日 | 完成后端模块中的语句解析子模块和查询子模块。 |
| 2023年12月4日-2023年12月10日 | 完成问句意图识别子任务的模型构建，使用中文医疗信息处理评测基准CBLUE中的医疗搜索检索词意图分类KUAKE-QIC数据集作为原始数据集，进行筛选后形成本次实验所需的数据集。使用数据集训练模型，完成了对比试验。 |
| 2023年10月18日-2023年12月3日 | **1.** 使用瑞金医院糖尿病数据集构建了糖尿病知识图谱，并通过爬虫脚本从39健康网爬取运动数据，向知识图谱中加入运动类型节点；</br> **2.** 构建BERT-BiGRU-CRF命名实体识别模型以及对照组模型，将ccks_2017_task2、ccks_2018_task1、瑞金医院糖尿病数据集进行数据筛选以及融合，使用融合数据集训练模型，完成了问句命名实体识别子任务的对比试验；</br> **3.** 构建BERT-TextRNN-Att模型以及对照组模型，准备实现问句意图识别子任务。 | -->

## 预训练模型

本系统采用了[RoBERTa-wwm-ext预训练模型](https://github.com/ymcui/Chinese-BERT-wwm)。  

- **[Pre-Training with Whole Word Masking for Chinese BERT](https://ieeexplore.ieee.org/document/9599397)**  
- *Yiming Cui, Wanxiang Che, Ting Liu, Bing Qin, Ziqing Yang*
- Published in *IEEE/ACM Transactions on Audio, Speech, and Language Processing (TASLP)*

## 模型权重下载

本系统使用命名实体识别模型和意图识别模型对用户输入的问句进行解析，模型的权重文件需要单独下载并放置在指定位置（详见./nlp/README.md）。  

| 模型 | 提取码 |
| :------- | :------- |
| [命名实体识别（ner）](https://pan.baidu.com/s/1AbCy6DRa6165H3GZ7k1hVw) | 2405 |
| [意图识别（ir）](https://pan.baidu.com/s/1Yoe_VXaSrEuMEJszcMrqQA) | 2405 |

## 环境需求

### 软件需求

| 名称 | 版本 | 备注 |
| :------- | :------- | :------- |
| CUDA | >=9.1.85 | Nvidia |
| MySQL | >=8.0.33 | Community Server |
| Neo4j | >=4.4.26 | Community |
| Python | >=3.9.18 | Anaconda/Python |
| Apache Jmeter | >=5.6.3 | - |
| OpenSSL | >=3.2.1 | 非必须，为应用程序的域名或IP地址签发证书 |

### Python软件包

| 名称 | 版本 |
| :------- | :------- |
| Transformers | >=4.3.50 |
| PyTorch | >=1.10.2 |
| NumPy | >=1.23.5 |
| Tqdm | >=4.66.1 |
| TorchCRF | >=1.1.0 |
| Flask | >=3.0.0 |
| Flas Session | >=0.4.0 |
| lxml | >=4.9.3 |
| py_stringmatching | >=0.4.3 |
| Jieba | >=0.42.1 |
| py2neo | >=2021.2.4 |
| pymysql | >=1.0.2 |
| Selenium | >=3.141.0 |

### 前端插件

| 名称 | 版本 |
| :------- | :------- |
| Bootstrap | 5.3.0-alpha1 |
| Font Awesome | free-6.5.1 |
| D3.js | 7.8.5 |

## 系统测试结果  

### 功能测试  

**测试工具：** Selenium

| 功能 | 准确率 | 知识覆盖率 |
| :------- | :------- | :------- |
| 医疗对话 | 98.75% | 87.50% |
| 知识图谱展示 | 100% | - |
| 知识图谱展示（搜索结点） | 94% | - |

### 性能测试  

**测试工具：** Apache JMeter

| 功能 | 线程数 | 通过率 | 中位时间（ms） |
| :------- | :------- | :------- | :------- |
| 登录 | 100 | 100% | 2338.00|
| 医疗对话 | 100 | 100% | 4489.00 |
| 知识图谱展示 | 100 | 100% | 3063.50 |
| 知识图谱展示（搜索结点） | 100 | 100% | 1443.50 |
| 历史记录 | 100 | 100% | 2547.00 |

## 实验结果  

### 命名实体识别（NER）  

| 模型 | Accuracy | Recall | F1 |
| :------- | :--------- | :------- | :--------- |
| BERT-BiGRU-CRF (ours) | 0.9746952585148948 | 0.9335107243291548 | 0.9283659838400309 |
| BiGRU-CRF | 0.9666730133306387 | 0.9189975410098702 | 0.9114157975168634 |
| BiGRU-Softmax | 0.9683184501791638 | 0.9154070163917805 | 0.913073787609583 |

### 意图识别（IR）  

| 模型 | Accuracy |
| :------- | :--------- |
| BERT-TextRNN-Att (ours) | 0.8250950570342205 |
| BERT-TextRNN | 0.8136882129277566 |
| BERT-TextRCNN | 0.8124207858048162 |
| BERT-TextCNN | 0.6438529784537389 |

## 仓库目录说明  

```text
repo                    #仓库根目录
   |- graph             #知识图谱构建模块
   |- nlp               #自然语言处理模块
   |- backend           #后端模块 
   |- frontend          #前端模块
   |- database          #数据库查询语句
```
